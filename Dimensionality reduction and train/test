
# 1. Split the full dataset before separation or transformation , 80% train, 20% test
train_df, test_df = train_test_split(
    df_processed, test_size=0.2, random_state=42
)

print("Data Split:")
print(f"Training set: {train_df.shape[0]} samples ({train_df.shape[0]/len(df_processed)*100:.1f}%)")
print(f"Test set: {test_df.shape[0]} samples ({test_df.shape[0]/len(df_processed)*100:.1f}%)")
print(f"Nombre de colonnes: {train_df.shape[1]}")

# 2. Separate X / y after the split
X_train = train_df.drop(columns=[target])
y_train = train_df[target]

X_test = test_df.drop(columns=[target])
y_test = test_df[target]

print("\nSéparation après split :")
print(f"X_train: {X_train.shape}, y_train: {y_train.shape}")
print(f"X_test: {X_test.shape}, y_test: {y_test.shape}")

# 3. Standardization (fit on train only, transform on test)
scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

X_train_scaled = pd.DataFrame(X_train_scaled, columns=X_train.columns, index=X_train.index)
X_test_scaled = pd.DataFrame(X_test_scaled, columns=X_test.columns, index=X_test.index)

print("\nStandardisation réalisée (fit sur train, transform sur test).")

# 4. Log transformation of the target variable
print("\nLog transformation du target :")
print(f"Before transformation - y_train range: [{y_train.min():.2f}, {y_train.max():.2f}]")

y_train_log = np.log1p(y_train)
y_test_log = np.log1p(y_test)

print(f"After transformation - y_train_log range: [{y_train_log.min():.2f}, {y_train_log.max():.2f}]")
print(f"Skewness reduce: {y_train.skew():.2f} -> {y_train_log.skew():.2f}")



